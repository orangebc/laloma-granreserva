jQuery.validator.addMethod("expression", function(value, element, param) {
    return value.match(new RegExp("^" + param + "$"));
});
var availableTags;
$(function () {
	$("#telefono").ForceNumericOnly();
	//email tags
	$.ajax({
		url: "php/emailDomains.php",
		dataType: "json",
		success: function(data) {
			availableTags = data.domains;
		}
	});

	$("#email").autocomplete({
		source: availableTags
	});
	$("#email").keyup(function(event) {
		if (availableTags !== undefined) {
			if (event.target.value.indexOf("@") == -1) {
				var new_options = [];
				for (var i = 0; i < availableTags.length; i++)
					new_options[i] = $(this).val() + availableTags[i];
				$(this).autocomplete("option", "source", new_options);
			}
		}
	});
	//email tags
	$("#step1").validate({
		rules: {
			nombre: {
				required: true,
				expression: "[a-zA-Z Ññáéíóú]+"
			},
			apellido: {
				required: true,
				expression: "[a-zA-Z Ññáéíóú]+"
			},
			telefono: {
				required: true,
				digits: true,
				mobileMX10: true
			},
			email: {
			   required: true,
			   email: true
		    }
        },
		messages: {
			nombre: {
				required: "Por favor escribe tu nombre",
				expression: "Ingresa un nombre valido"
			},
			apellido: {
				required: "Por favor escribe tu apellido",
				expression: "Ingresa un apellido valido"
			},
			telefono: {
				required: "Por favor escribe tu número de teléfono",
				digits: "Solo permite ingresar números",
				minlength: "El telefono debe contener 10 dígitos (clave lada + número telefónico)"
			},
			email: {
			   required: "Por favor escribe tu correo electrónico",
			   email: "Solo permite ingresar correos electrónicos validos"
		    }
		},
		debug: true,
		onfocusout:false,
		onkeyup:false,
		onclick:false,
		submitHandler: function(form) {
				checkForm(form);
		},
		errorPlacement: function (error, element) {
		},
		showErrors: function(errorMap, errorList){
			this.defaultShowErrors();
			if(errorList.length) {
				alert(errorList[0].message);
			}
		}
	});
});

function checkForm(form){
	var formID ="#step1";
	var formURL = "php/step1.php";
	var formData = $(formID).serialize();
	$.post(formURL, formData, function(data){
		if(data.message=="success"){
			alert('Gracias, en breve nos comunicaremos con usted.');
			$("#step1").fadeOut(2000);
			$("#conv").html(data.conv);
		}
		return false;
	},"json");
}